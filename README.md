# CoreML-RealESRGAN CLI

A simple command-line tool that uses Core ML version of **RealESRGAN_x4plus** for macOS  
to perform image super-resolution (SR). It uses a **FP16-MLProgram** model generated by the conversion script for inference.

## Update History
- 2023/5/22
    - Initial release as the tool became functional. Published as a practice for using GitHub.

## Future Plans
- Add batch processing for folder inputs and implement the `--suffix` option

---
## Features

| Item | Description |
| ---- | ---- |
| **Input** | RGB images like PNG/JPEG (variable resolution) |
| **Output** | 4× upscaled PNG (BGRA, sRGB) |
| **Model** | `RealESRGAN_x4plus.mlmodelc` (FP16・MLProgram) |
| **Speed** | ≒ 0.6 s / 256×256px on Apple Silicon M-series (reference value) |
| **Requirements** | macOS 14 or later / Xcode 15 or later |

---

## File Structure
```
SimpleImageSR/          Xcode project
├── main.swift       … CLI entry point
├── ImageConverter.swift     … Image conversion utilities
├── ImageLoader.swift        … Image loading processor
├── ImageSaver.swift         … Image saving processor
├── SuperResolutionEngine.swift  … Super-resolution engine core
├── SuperResolutionError.swift   … Error definitions
├── RealESRGAN_x4plus.mlpackage/   … Core ML (FP16) model
├── readme.md        … This file (Japanese)
└── README_en.md     … English version README
scripts/
├── quick_sr.py      … Test script for using RealESRGAN x4+ CoreML model with coremltools
└── convert_pth2coreml_new.py     … PyTorch → CoreML conversion script
```

## Build & Run

```bash
# 1) Model conversion (first time only)
python scripts/convert_pth2coreml_new.py \
  --pth weights/RealESRGAN_x4plus.pth \
  --out SimpleImageSR/RealESRGAN_x4plus.mlpackage \
  --float16 --target mac

# 2) Build with Xcode (Release or Debug)

# 3) Infer image
./SimplePhotoSR input.png output.png
```
 
### Model Prerequisites
- Uses Real-ESRGAN x4+ model trained in PyTorch and converted to CoreML format. For conversion details, refer to [convert_pth2coreml_new.py](scripts/convert_pth2coreml_new.py).

---

## Acknowledgements

This project is a lightweight Core ML wrapper around the excellent **[Real‑ESRGAN](https://github.com/xinntao/Real-ESRGAN)** by Xintao et al.  
All credit for the underlying super‑resolution model architecture and pretrained weights belongs to the Real‑ESRGAN authors and community contributors.

---

## License

This project is released under the MIT License.
See the `LICENSE` file for details.

The included Real-ESRGAN model and weights are subject to the original [Real-ESRGAN License](https://github.com/xinntao/Real-ESRGAN/blob/master/LICENSE).
